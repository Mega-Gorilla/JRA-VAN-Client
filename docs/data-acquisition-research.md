# 日本競馬データ取得方法に関する調査レポート

## 概要
本ドキュメントは、日本の競馬予測モデル（トランスフォーマーベース）を開発するために必要な競馬データの取得方法について調査した結果をまとめたものです。

## 主要なデータ取得方法

### 1. JRA-VAN DataLab（公式・有料）

#### 概要
- JRA系列会社であるJRAシステムサービス株式会社が運営する公式データサービス
- 最も信頼性が高く、リアルタイムでのデータ更新が可能
- JV-Link APIを通じてプログラムからアクセス可能

#### 料金体系
- 月額：2,090円（税込）
- 年額：約25,080円

#### 提供データ
- レース情報（中央競馬全レース）
- 地方競馬の指定交流重賞
- 馬情報（血統、成績等）
- リアルタイム情報（馬体重、オッズ等）
- データ形式：固定長テキスト形式（JV-Data）

#### 技術仕様
- **API**: JV-Link（ActiveX COMコントロール）
- **対応言語**: 
  - 公式：C++, VB.NET, C#
  - 非公式：Python（32bit版のみ、pywin32パッケージ必要）
- **Pythonでの利用時の制約**:
  - 32bit版Pythonが必要（JV-Linkが32bitのみ対応）
  - 64bit版Pythonを使用する場合は「DLLサロゲート」方式で対応可能
  - 公式サポートではないため動作保証なし

### 2. Netkeiba Webスクレイピング（非公式・無料）

#### 概要
- 日本最大級の競馬情報サイト「netkeiba.com」からデータを取得
- WebスクレイピングによりHTMLページから必要な情報を抽出

#### 2025年現在の状況
- **アンチスクレイピング対策の強化**:
  - JavaScriptによる動的コンテンツ生成
  - 標準的なrequestsライブラリでは取得困難
  - Seleniumなどのブラウザ自動化ツールが必要
- **利用時の注意事項**:
  - 利用規約違反の可能性あり
  - アクセス頻度制限の実装が必要（例：100リクエストごとに30分待機）
  - 自然なアクセスパターンの模倣が重要

#### 実装技術
- **推奨言語とライブラリ**:
  - Python: Selenium, BeautifulSoup, requests
  - R: RSelenium
  - その他: Ruby, PHP, Scala

### 3. その他のデータソース

#### JRDB（有料）
- 日次でZIPファイルを公開
- 固定長テキスト形式
- カスタムパーサーが必要
- 提供データ：結果、ラップタイム、パドック指数、調教指数、トラックバイアス等

#### TARGET（有料）
- 競馬予想ソフトウェア
- CSV形式でのデータエクスポート機能あり
- 可視化・探索ツールとして有用

#### 個人提供データ（無料・信頼性要確認）
- Note.comなどで個人が公開しているCSVデータ
- 更新頻度や正確性は提供者に依存

### 4. JRA公式サイト
- レース成績データをPDF形式で提供
- 機械可読性は低い
- PDFパースが必要

## データ取得戦略の推奨

### 初心者向け（実験・プロトタイプ）
1. netkeibaからの小規模スクレイピング
2. 個人提供のCSVデータを活用
3. 基本的な機械学習モデルで実験

### 中級者向け（本格的な開発）
1. JRA-VAN DataLabの契約（月額2,090円）
2. Pythonでの自動化システム構築
3. データベース化（MySQL、PostgreSQL等）

### 上級者向け（大規模AI開発）
1. 複数データソースの統合
   - JRA-VAN（公式データ）
   - JRDB（詳細指数データ）
   - カスタムスクレイパー（補完データ）
2. リアルタイムデータパイプラインの構築
3. 大規模データベースシステムの実装

## 機械学習・ディープラーニングの実装状況

### 既存の実装例
- **精度**: 
  - 一般的な機械学習：約70%の精度
  - 最適化されたモデル：最大80%の精度
- **アプローチ**:
  - CNN（畳み込みニューラルネットワーク）の利用例あり
  - 特徴量エンジニアリングが精度向上の鍵
  - レース人気データの重要性

### トランスフォーマー/BERTの適用可能性
- **利用可能なリソース**:
  - Hugging Face Transformersライブラリ
  - 日本語BERT（japanese-base, japanese-base-wwm）
  - 12層、隠れ層768次元のモデルが利用可能
- **競馬予測への応用**:
  - 直接的な実装例は少ない
  - テキストデータ（コメント、記事）の分析に活用可能
  - 時系列データとしてのレース結果の処理に適用可能

## データベース設計の推奨

### 基本構造
```
- races（レーステーブル）：親テーブル
  - race_id（主キー）
  - race_date
  - racecourse
  - race_number
  - race_name
  - distance
  - track_condition
  
- horses（馬テーブル）
  - horse_id（主キー）
  - horse_name
  - birth_date
  - sex
  - pedigree（5代血統）
  
- results（結果テーブル）
  - race_id（外部キー）
  - horse_id（外部キー）
  - finish_position
  - jockey_id
  - trainer_id
  - odds
  - time
```

## 法的・倫理的配慮

### 注意事項
1. **利用規約の遵守**
   - 各サイトの利用規約を確認
   - 商用利用の可否を確認
   
2. **アクセス頻度の制限**
   - サーバー負荷を考慮
   - 適切な待機時間の設定
   
3. **データの正確性**
   - 公式データソースの利用を推奨
   - 非公式データは検証が必要

## 実装ロードマップの提案

### Phase 1: データ収集基盤の構築（1-2週間）
1. データソースの選定
2. スクレイピング/API接続システムの実装
3. データ保存形式の決定

### Phase 2: データベース構築（1週間）
1. データベーススキーマ設計
2. データクレンジング処理
3. バックアップ体制の構築

### Phase 3: 特徴量エンジニアリング（2-3週間）
1. 基本特徴量の抽出
2. 派生特徴量の生成
3. 特徴量の重要度分析

### Phase 4: モデル開発（3-4週間）
1. ベースラインモデルの構築
2. トランスフォーマーモデルの実装
3. ハイパーパラメータチューニング

### Phase 5: 評価と改善（継続的）
1. バックテストの実施
2. モデルの精度評価
3. 継続的な改善

## 推奨技術スタック

### 開発環境
- **言語**: Python 3.8+
- **主要ライブラリ**:
  - データ取得: requests, selenium, beautifulsoup4
  - データ処理: pandas, numpy
  - 機械学習: scikit-learn, xgboost, lightgbm
  - ディープラーニング: pytorch, transformers (Hugging Face)
  - データベース: sqlalchemy, psycopg2
  
### インフラストラクチャ
- **データベース**: PostgreSQL or MySQL
- **ストレージ**: AWS S3 or ローカルNAS
- **計算リソース**: GPU搭載マシン（トランスフォーマー学習用）

## まとめ

日本の競馬データ取得には複数の選択肢があり、プロジェクトの規模と予算に応じて選択すべきです。

- **小規模実験**: netkeibaスクレイピング（無料だが制約あり）
- **本格開発**: JRA-VAN DataLab（月額2,090円で公式データ）
- **大規模AI**: 複数データソースの統合

トランスフォーマーモデルの競馬予測への応用は発展途上であり、新規性のある研究開発の余地が大きい分野です。適切なデータ収集基盤を構築した上で、特徴量エンジニアリングとモデルアーキテクチャの最適化に注力することが成功の鍵となるでしょう。

## 参考リンク

- [JRA-VAN DataLab公式サイト](https://jra-van.jp/dlb/)
- [netkeiba.com](https://www.netkeiba.com/)
- [Hugging Face Transformers](https://github.com/huggingface/transformers)
- [JRA公式レース成績データ](https://www.jra.go.jp/datafile/seiseki/)

---
*最終更新日: 2025年8月28日*